---
description: Unified UX, UI, design system, interactions, accessibility, motion, and performance guidelines. Use when building components, forms, interactions, or implementing design patterns.
globs:
  - "**/components/**"
  - "**/*.tsx"
  - "app/**/*.tsx"
alwaysApply: false
---

## Foundation

### Design Inspirations
- **Default references**
  - **Airbnb** – Exceptional search and filtering UX, image-first content presentation, trust-building through reviews and verification, clear pricing transparency, mobile-first responsive design.
  - **OpenAI** – Clean, minimal interfaces for complex AI interactions, clear information hierarchy, excellent loading states and progressive disclosure, thoughtful error handling and user guidance.
  - **Dia Browser** – Modern browser UI patterns, efficient space utilization, smooth transitions, intuitive navigation, polished micro-interactions.
- **How to use**
  - **MUST:** Study these references before designing similar features; understand the "why" behind their patterns, not just copy the "what".
  - **SHOULD:** Analyze their information architecture, interaction patterns, and visual hierarchy when facing similar design challenges.
  - **SHOULD:** Reference specific patterns (e.g., "Airbnb's date picker approach" or "OpenAI's streaming response pattern") when proposing solutions.
  - **AVOID:** Copying without understanding context; adapt patterns to fit your product's unique needs and constraints.

### Self-Evident Experience
- **Clarity**
  - **MUST:** Keep each screen self-evident: primary action is obvious, grouping follows hierarchy, entry points are unmistakable.
  - **MUST:** Size/position the most important elements for immediate recognition; NEVER make users guess what's clickable.
  - **SHOULD:** Reuse proven patterns; new paradigms require explicit cues.
- **User behavior truths**
  - **MUST:** Design for scanning (headlines, bullets, whitespace) because users skim.
  - **MUST:** Assume mistakes will happen; provide undo, retries, and autosave for long inputs.
  - **MUST:** Give instant feedback for every action (loading, success, error).
- **Content & copy**
  - **MUST:** Remove fluff: active voice, concrete nouns, no jargon.
  - **MUST:** Make headlines descriptive and keyword-rich; match page content exactly.
  - **MUST:** Ensure color is never the sole carrier of meaning; pair icons/text/patterns.
  - **SHOULD:** Cut instructions in half and show examples rather than paragraphs.
- **Performance perception**
  - **MUST:** Use skeletons/placeholders over blank states, show progress for long work, and favor optimistic UI with reconciliation/rollback paths.

## UX Designer

### Navigation
- **MUST:** Provide persistent nav with active states/breadcrumbs; match labels to user mental models.
- **MUST:** Indicate progress for multi-step flows, and NEVER create dead ends—always offer next/recovery actions.
- **MUST:** Use anchors for navigation (supporting Cmd/Ctrl/middle-click); buttons mutate state only.
- **MUST:** Keep URLs in sync with shareable state (filters, tabs, pagination) and honor back/forward history + scroll position. Prefer libs like [nuqs](https://nuqs.dev).
- **MUST:** Back/Forward restores scroll.
- **SHOULD:** Surface search prominently and make thumb-friendly primary actions on mobile.

### Forms & Inputs
- **MUST:** Pair every input with an explicit label (never rely on placeholder-only); required fields are clearly marked.
- **MUST:** Pre-fill known data, validate in real time, and allow submitting incomplete forms to surface validation.
- **MUST:** Place errors nearest the field, include why + fix instructions, and focus the first error upon submit.
- **MUST:** Keep inputs hydration-safe, allow paste (especially OTPs/passwords), support password managers/2FA, and warn before abandoning unsaved work.
- **MUST:** Use `autocomplete` + meaningful `name`; correct `type` and `inputmode`.
- **MUST:** Loading buttons show spinner and keep original label.
- **MUST:** Enter submits focused text input. In `<textarea>`, ⌘/Ctrl+Enter submits; Enter adds newline.
- **MUST:** Keep submit enabled until request starts; then disable, show spinner, use idempotency key.
- **MUST:** Don't block typing; accept free text and validate after.
- **MUST:** Trim values to handle text expansion trailing spaces.
- **MUST:** No dead zones on checkboxes/radios; label+control share one generous hit target.
- **SHOULD:** Include examples via placeholders that end with ellipsis (`…`), trim trailing spaces, and disable spellcheck for usernames/emails/codes.
- **SHOULD:** Autofocus on desktop when there's a single primary input; rarely on mobile (to avoid layout shift).

### Feedback & Messaging
- **MUST:** Confirm destructive work or provide an Undo window; use polite `aria-live` for toasts/inline validation.
- **SHOULD:** Prefer optimistic UI while syncing with the server; on failure, show actionable error + rollback or Undo.
- **SHOULD:** Use ellipsis (`…`) for options that open follow-ups (eg, "Rename…") and loading states (eg, "Loading…", "Saving…", "Generating…").

## UI Developer

### Design System & Components
- **Component reuse**
  - **MUST:** Pull from `components/ui/*` before attempting bespoke builds; NEVER fork when a design-system primitive exists.
  - **MUST:** Use built-in variants (`default`, `outline`, `destructive`, `ghost`, etc.) before inventing new props.
- **Tokens & colors**
  - **MUST:** Reference semantic tokens (`bg-background`, `text-foreground`, `bg-primary`, etc.) instead of hard-coded hex/rgb/hsl.
  - **MUST:** Define tokens as CSS variables in `globals.css` and consume them through Tailwind config; NEVER inline brand colors inside components.
- **Accessibility with utilities**
  - **MUST:** Provide focus rings (`focus:ring-2 focus:ring-primary focus:ring-offset-2`) and enforce contrast (APCA preferred) in both light/dark themes.

### Design Details
- **MUST:** Accessible charts (color-blind-friendly palettes); meet contrast—prefer [APCA](https://apcacontrast.com/) over WCAG 2; increase contrast on `:hover/:active/:focus`.
- **SHOULD:** Layered shadows (ambient + direct); crisp edges via semi-transparent borders + shadows; nested radii: child ≤ parent; concentric; hue consistency: tint borders/shadows/text toward bg hue; match browser UI to bg; avoid gradient banding (use masks when needed).

### Layout
- **MUST:** Deliberate alignment to grid/baseline/edges/optical centers—no accidental placement.
- **MUST:** Verify mobile, laptop, ultra-wide (simulate ultra-wide at 50% zoom).
- **MUST:** Respect safe areas (use env(safe-area-inset-*)).
- **MUST:** Avoid unwanted scrollbars; fix overflows.
- **SHOULD:** Optical alignment; adjust by ±1px when perception beats geometry.
- **SHOULD:** Balance icon/text lockups (stroke/weight/size/spacing/color).

## Accessibility Specialist

### Keyboard & Focus
- **MUST:** Implement full keyboard support per [WAI-ARIA APG](https://www.w3.org/WAI/ARIA/apg/patterns/), including focus traps/return for dialogs.
- **MUST:** Show visible focus via `:focus-visible` (and `:focus-within` on groups); NEVER hide focus for keyboard paths.
- **MUST:** Manage focus (trap, move, and return) per APG patterns.

### Hit Targets & Touch
- **MUST:** Provide ≥24px hit targets (mobile comfort ≥44px) even if the visual target is smaller.
- **MUST:** Set `touch-action: manipulation`, respect browser zoom, and never disable pinch/zoom.
- **MUST:** Set `-webkit-tap-highlight-color` to match design.
- **MUST:** Mobile `<input>` font-size ≥16px or set viewport meta tag.
- **MUST:** Handle drag/scroll with `overscroll-behavior: contain` in modals and disable text selection during drags.
- **MUST:** During drag, disable text selection and set `inert` on dragged element/containers.
- **MUST:** Design forgiving interactions (generous targets, clear affordances; avoid finickiness).
- **MUST:** No "dead-looking" interactive zones—if it looks clickable, it is.
- **SHOULD:** Delay the first tooltip, then show subsequent peers instantly with no animation.

### Content Resilience
- **MUST:** Craft empty, sparse, dense, loading, and error states.
- **MUST:** Ensure icons without text have `aria-label`, decorative items are `aria-hidden`, and headings use a proper hierarchy with `scroll-margin-top` for anchors.
- **MUST:** Design for UGC extremes (very short/long strings); resilient to user-generated content (short/avg/very long); keep locale-aware formatting for dates/times/numbers/currency.
- **MUST:** Skeletons mirror final content to avoid layout shift; `<title>` matches current context; no dead ends—always offer next step/recovery.
- **MUST:** Tabular numbers for comparisons (`font-variant-numeric: tabular-nums` or a mono like Geist Mono).
- **MUST:** Redundant status cues (not color-only); icons have text labels.
- **MUST:** Don't ship the schema—visuals may omit labels but accessible names still exist.
- **MUST:** Use the ellipsis character `…` (not ``).
- **MUST:** `scroll-margin-top` on headings for anchored links; include a "Skip to content" link; hierarchical `<h1–h6>`.
- **MUST:** Locale-aware dates/times/numbers/currency; accurate names (`aria-label`), decorative elements `aria-hidden`, verify in the Accessibility Tree.
- **MUST:** Icon-only buttons have descriptive `aria-label`; prefer native semantics (`button`, `a`, `label`, `table`) before ARIA.
- **MUST:** Use non-breaking spaces to glue terms: `10&nbsp;MB`, `⌘&nbsp;+&nbsp;K`, `Vercel&nbsp;SDK`.
- **SHOULD:** Inline help first; tooltips last resort; curly quotes (" "); avoid widows/orphans; right-clicking the nav logo surfaces brand assets.

## Motion Designer

### Motion Principles
- **Purpose first**
  - **MUST:** Ensure every animation delivers feedback, explains state change, or adds rare delight; NEVER animate for its own sake.
- **Frequency**
  - **MUST:** Remove animations from high-frequency interactions (command menus, keyboard navigation, hover loops); medium frequency gets minimal motion; low frequency can host richer delight.
  - **NEVER:** Animate keyboard-initiated focus changes or routes visited dozens of times per day.
- **Perceived speed & easing**
  - **MUST:** Keep UI motion under 300 ms (dropdowns ≈180 ms, tooltips 125 ms) and default to `ease-out` or tuned springs.
  - **SHOULD:** Avoid `scale(0)` starts—begin near 0.9 for natural feels; set transform origins to the trigger point.
- **Taste & critique**
  - **SHOULD:** Regularly study Linear, Raycast, Apple, etc., and articulate _why_ an animation feels right or wrong.
  - **SHOULD:** Embrace the "taste gap": early attempts may lag behind taste; iterate and solicit critique.
- **Accessibility & control**
  - **MUST:** Honor `prefers-reduced-motion` with reduced variants or near-instant transitions.
  - **MUST:** Make animations interruptible/input-driven; autoplay only when absolutely necessary (e.g., passive ambient loops).
- **Animation basics**
  - **MUST:** Honor `prefers-reduced-motion` (provide reduced variant); animate compositor-friendly props (`transform`, `opacity`); avoid layout/repaint props (`top/left/width/height`); animations are interruptible and input-driven (avoid autoplay); correct `transform-origin` (motion starts where it "physically" should).
  - **SHOULD:** Prefer CSS > Web Animations API > JS libraries; animate only to clarify cause/effect or add deliberate delight; choose easing to match the change (size/distance/trigger).

### Motion Patterns
- **Micro-feedback**
  - **MUST:** Add subtle `whileTap` scale (~0.97) or active-state transforms on buttons.
  - **SHOULD:** Add shake/scale cues for error/success yet keep them ≤500 ms and non-startling.
- **Tooltips & overlays**
  - **MUST:** Delay the first tooltip, then show subsequent ones instantly; scale/pop from trigger origin with `transform-origin` tokens.
  - **MUST:** Animate modal backdrops (≈200 ms fade) and content (spring from `scale 0.95 → 1`, small `y` offset); exits slightly faster.
- **Lists & layout**
  - **MUST:** Animate list add/remove with `layout` + `AnimatePresence` to preserve spatial memory; keep exit durations ≤200 ms.
  - **SHOULD:** Stagger small lists (50–100 ms) but NEVER for high-frequency feeds.
- **Page & route transitions**
  - **SHOULD:** Use subtle (≤20px) translations around 150–250 ms when spatial context matters; skip for frequently visited routes/back navigation where immediacy wins.
- **Loading & progress**
  - **MUST:** Animate skeleton shimmer, spinner rotation via `transform`, and progress bars with smooth `ease-out`. Faster spinning increases perceived speed.
- **Scroll & gesture triggers**
  - **SHOULD:** Use `useInView` / Intersection Observer with `once: true` for scroll reveals (20–50 px travel) and springs for drag/snap gestures.
  - **MUST:** Disable text selection during drag, set thresholds for swipe actions, and provide elastic resistance.
- **Composition & pitfalls**
  - **MUST:** Focus on 2–3 properties per animation, avoid animating layout props, and never block pointer events while animating.
  - **SHOULD:** Use blur as a last-resort blend between states when other tweaks fail.

### Framer Motion & Testing
- **Testing regimen**
  - **MUST:** Verify screen readers announce content changes (not animation), keyboard paths stay instant, and interrupted animations recover gracefully.
  - **SHOULD:** Test motion on low-end hardware, throttled CPU/network, Safari, and with `prefers-reduced-motion` toggled.
  - **SHOULD:** Profile with Chrome Performance, watch for layout thrash, and keep frame rates near 60 fps.

## Performance Engineer

### Measurement
- **MUST:** Measure reliably (disable extensions that skew runtime); track and minimize re-renders (React DevTools/React Scan); profile with CPU/network throttling.
- **SHOULD:** Test iOS Low Power Mode and macOS Safari.

### Optimization
- **MUST:** Batch layout reads/writes; avoid unnecessary reflows/repaints; mutations (`POST/PATCH/DELETE`) target <500 ms; virtualize large lists (eg, `virtua`); preload only above-the-fold images; lazy-load the rest; prevent CLS from images (explicit dimensions or reserved space).
- **MUST:** Animate only compositor-friendly props (`transform`, `opacity`).
- **SHOULD:** Prefer uncontrolled inputs; make controlled loops cheap (keystroke cost).
